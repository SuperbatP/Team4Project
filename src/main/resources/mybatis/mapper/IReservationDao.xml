<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.PhoenixHospital.reservation.dao.IReservationDao">
    <select id="getReservationList" resultType="com.PhoenixHospital.reservation.vo.ReservationVO">
        SELECT
            reservation_no,
            mem_name,
            mem_id,
            mem_hp,
            treatment_code,
            dc_id,
            reservation_date,
            reservation_time,
            reservation_reg_date,
            etc,
            cancel_date,
            reservation_mod_date,
            attendance_id,
            mem_email
        FROM reservation
    </select>

    <select id="getReservation" resultType="com.PhoenixHospital.reservation.vo.ReservationVO">
        SELECT
            reservation_no,
            mem_name,
            mem_id,
            mem_hp,
            treatment_code,
            dc_id,
            reservation_date,
            reservation_time,
            reservation_reg_date,
            etc,
            cancel_date,
            reservation_mod_date,
            attendance_id,
            mem_email
        FROM reservation
        WHERE reservaion_no = #{reservationNo}
    </select>

    <update id="updateReservation">
        UPDATE reservation
        SET
            mem_hp              = #{memHp},
            mem_email           = #{memEmail},
            dc_id               = #{dcId},
            treatment_code      = #{treatmentCode},
            reservation_date    = #{reservationDate},
            reservation_time    = #{reservationTime},
            reservation_mod_date = sysdate,
            etc                 = #{etc},
            attendance_id        = null
        WHERE
            reservation_no = #{reservationNo}
    </update>

    <update id="deleteReservation">
        UPDATE reservation
        SET
            cancel_date = sysdate
        WHERE
            reservation_no = #{reservationNo}
    </update>

    <insert id="insertReservation">
        <selectKey keyProperty="reservationNo" resultType="string" order="BEFORE">
            SELECT 'RENO' || LPAD(seq_reservation.nextval, 4, '0') FROM dual
        </selectKey>

        INSERT INTO reservation (
            reservation_no,
            mem_name,
            mem_id,
            mem_hp,
            mem_email,
            dc_id,
            treatment_code,
            reservation_date,
            reservation_time,
            reservation_reg_date,
            reservation_mod_date,
            etc,
            cancel_date,
            attendance_id
        ) VALUES (
                  #{reservationNo},
                  #{memName},
                  #{memId},
                  #{memHp},
                  #{memEmail},
                  #{dcId},
                  #{treatmentCode},
                  #{reservationDate},
                  #{reservationTime},
                  sysdate,
                  null,
                  #{etc},
                  null,
                  null
                         )
    </insert>
</mapper>