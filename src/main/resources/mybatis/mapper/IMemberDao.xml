<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.PhoenixHospital.member.dao.IMemberDao">


    <sql id="searchInMember" >
        <if test='!@org.apache.commons.lang3.StringUtils@isBlank(search.searchWord)'>
            <if test='search.searchType=="NM"'>
                AND mem_name LIKE '%' || #{search.searchWord} || '%'
            </if>
            <if test='search.searchType=="ID"'>
                AND mem_id LIKE '%' || #{search.searchWord} || '%'
            </if>
            <if test='search.searchType=="HP"'>
                AND mem_hp LIKE '%' || #{search.searchWord} || '%'
            </if>
        </if>
    </sql>

    <select id="getTotalRowCount" resultType="int">
        SELECT  count(*)
        FROM member
        WHERE 1=1
        <include refid="searchInMember" />
    </select>

    <select id="getMemberList" resultType="com.PhoenixHospital.member.vo.MemberVO">
        SELECT *
        FROM (
        SELECT a.*, rownum AS rnum
        FROM (
        SELECT
        to_char(mem_bir, 'YYYY-MM-DD') AS mem_bir,
        mem_id,
        mem_password,
        mem_name,
        mem_zip,
        mem_add1,
        mem_add2,
        mem_hp,
        mem_email,
        mem_del_yn,
        mem_role
        FROM member
        ORDER BY mem_id DESC
        ) a
        )
        WHERE rnum BETWEEN #{paging.firstRow} AND #{paging.lastRow};
    </select>

    <select id="getMember" resultType="com.PhoenixHospital.member.vo.MemberVO" parameterType="String">
        SELECT
            mem_bir
             , mem_id               , mem_password             , mem_name
             , mem_zip              , mem_add1               , mem_add2
             , mem_hp               , mem_email               , mem_del_yn
             , mem_role
        FROM member a
        WHERE a.mem_id=#{memId}


    </select>

    <update id="updateMember">
        UPDATE member
        SET
            mem_password   =#{memPassword}
          , mem_name   =#{memName}
          , mem_bir    =#{memBir}
          , mem_zip    =#{memZip}
          , mem_add1   =#{memAdd1}
          , mem_add2   =#{memAdd2}
          , mem_hp     =#{memHp}
          , mem_email   =#{memEmail}
          , mem_role   =#{memRole}
        WHERE mem_id = #{memId}

    </update>

    <delete id="deleteMember" parameterType="String">
        UPDATE member SET mem_del_yn='Y'
        WHERE mem_id=#{memId}
    </delete>

    <insert id="memGenderMember">
        INSERT INTO member ( mem_id, mem_password, mem_name
                           , mem_bir, mem_zip, mem_add1
                           , mem_add2, mem_hp, mem_email
                           , mem_del_yn, mem_role)
        VALUES ( #{memId}, #{memPassword}, #{memName}
               , #{memBir}, #{memZip}, #{memAdd1}
               , #{memAdd2}, #{memHp}, #{memMail}
               , 'N', 'USER')

    </insert>




</mapper>
